-- BASE DE DATOS UTILIZADA

USE GD2C2013
BEGIN TRANSACTION

-- CREACION DEL ESQUEMA

IF NOT EXISTS ( SELECT *
				FROM sys.schemas 
				WHERE name = N'VARIETE_GDD')  
EXEC ('CREATE SCHEMA [VARIETE_GDD] AUTHORIZATION [gd]');
GO

-- CREACION DE TABLAS

CREATE TABLE VARIETE_GDD.AFILIADO ( 
	AFI_NUMERO INTEGER IDENTITY(1,1) NOT NULL,
	AFI_TIPO_DOCUMENTO VARCHAR(3),
	AFI_DNI NUMERIC(8),
	AFI_NOMBRES VARCHAR(255),
	AFI_APELLIDO VARCHAR(255),
	AFI_DIRECCION VARCHAR(255),
	AFI_TELEFONO NUMERIC(18),
	AFI_MAIL VARCHAR(255),
	AFI_FECHA_NACIMIENTO DATETIME,
	AFI_SEXO CHAR(1), --'F' O 'M'
	AFI_ESTADO_CIVIL VARCHAR(11),
	AFI_CANTIDAD_FAMILIARES INTEGER,
	AFI_PLAN_MEDICO NUMERIC(18)	
)

CREATE TABLE VARIETE_GDD.PROFESIONAL ( 
	PRO_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	PRO_TIPO_DOCUMENTO VARCHAR(3),
	PRO_DNI NUMERIC(8),
	PRO_NOMBRES VARCHAR(255),
	PRO_APELLIDO VARCHAR(255),
	PRO_DIRECCION VARCHAR(255),
	PRO_TELEFONO NUMERIC(18),
	PRO_MAIL VARCHAR(255),
	PRO_FECHA_NACIMIENTO DATETIME,
	PRO_SEXO CHAR(1), --'F' O 'M'
	PRO_MATRICULA VARCHAR(50)
)

CREATE TABLE VARIETE_GDD.PROFESIONAL_ESPECIALIDADES (
	PROESP_PROFESIONAL INTEGER NOT NULL,
	PROESP_ESPECIALIDAD INTEGER NOT NULL
)

CREATE TABLE VARIETE_GDD.ESPECIALIDADES (
	ESP_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	ESP_DESCRIPCION VARCHAR (255),
	ESP_TIPO VARCHAR(80)
)

CREATE TABLE VARIETE_GDD.ADMINISTRADOR (
	ADM_CODIGO INTEGER IDENTITY(1,1) NOT NULL
)

CREATE TABLE VARIETE_GDD.USUARIO (
	USU_USERNAME VARCHAR(255) UNIQUE NOT NULL ,
	USU_CLAVE VARCHAR(255) NOT NULL,
	USU_CANTIDAD_INTENTOS INTEGER,
	USU_HABILITADO BIT
)

CREATE TABLE VARIETE_GDD.ROL_USUARIO (
	ROLUSU_USUARIO VARCHAR(255) NOT NULL,
	ROLUSU_ROL INTEGER NOT NULL
)

CREATE TABLE VARIETE_GDD.ROL (
	ROL_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	ROL_NOMBRE VARCHAR (255) NOT NULL,
	HABILITADO BIT NOT NULL
)

CREATE TABLE VARIETE_GDD.ROL_FUNCIONALIDADES (
	ROLFUN_ROL INTEGER NOT NULL,
	ROL_FUNCIONALIDAD INTEGER NOT NULL
)	

CREATE TABLE VARIETE_GDD.FUNCIONALIDADES (
	FUN_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	FUN_DESCRIPCION VARCHAR(80) NOT NULL
)

CREATE TABLE VARIETE_GDD.TURNOS (
	TUR_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	TUR_PROFESIONAL INTEGER NOT NULL,
	TUR_AFILIADO INTEGER NOT NULL,
	TUR_FECHA DATETIME NOT NULL
)	

CREATE TABLE VARIETE_GDD.BONO_CONSULTA (
	BONCON_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	BONCON_AFILIADO INTEGER NOT NULL,
	BONCON_CONSULTA INTEGER NOT NULL,
	BONCON_FECHA DATETIME NOT NULL,
	BONCON_PLAN INTEGER NOT NULL,
	BONCON_COMPRA INTEGER NOT NULL
)

CREATE TABLE VARIETE_GDD.CONSULTA (
	CON_CONSULTA INTEGER IDENTITY(1,1) NOT NULL,
	CON_PROFESIONAL INTEGER NOT NULL, 
	CON_PACIENTE INTEGER NOT NULL,
	CON_TURNO INTEGER NOT NULL,
	CON_FECHA_LLEGADA DATETIME,
	CON_SINTOMAS VARCHAR(255),
	CON_DIAGNOSTICO VARCHAR(1000),
	CON_BONO_CONSULTA INTEGER NOT NULL,
	CON_REALIZADA BIT
)

CREATE TABLE VARIETE_GDD.BONO_FARMACIA (
	BONFAR_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	BONFAR_AFILIADO INTEGER NOT NULL,
	BONFAR_FECHA DATETIME NOT NULL,
	BONFAR_RECETA INTEGER,
	--BONFAR_FECHA_VENCIMIENTO DATETIME?? ES CALCULABLE
	BONCON_PLAN INTEGER NOT NULL
)

CREATE TABLE VARIETE_GDD.RECETA (
	REC_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	REC_CONSULTA INTEGER NOT NULL 
)

CREATE TABLE VARIETE_GDD.RECETA_MEDICAMENTOS (
	RECMED_RECETA INTEGER NOT NULL,
	RECMED_MEDICAMENTOS INTEGER NOT NULL,
	RECMED_CANTIDAD INTEGER
)

CREATE TABLE VARIETE_GDD.MEDICAMENTOS (
	MED_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	MED_NOMBRE VARCHAR(255)
)

CREATE TABLE VARIETE_GDD.PLANES (
	PLA_CODIGO NUMERIC(18) IDENTITY(1,1) NOT NULL,
	PLA_DESCRIPCION VARCHAR(255),
	PLA_PRECIO_BONO_FARMACIA NUMERIC(18),
	PLA_PRECIO_BONO_CONSULTA NUMERIC (18)	
)

CREATE TABLE VARIETE_GDD.COMPRA (
	COM_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	COM_FECHA DATETIME,
	COM_CANTIDAD_BONO_FARMACIA INTEGER, --RELACIONA CON BONO_FARMACIA (FK)
	COM_CANTIDAD_BONO_CONSULTA INTEGER, --RELACIONA CON BONO_FARMACIA (FK)
	COM_PRECIO FLOAT,
	COM_AFILIADO INTEGER	
)	

--FALTA CREAR TABLA AGENDA, FORMULARIO Y ELEMENTOS


COMMIT;	