-- BASE DE DATOS UTILIZADA

USE GD2C2013
BEGIN TRANSACTION

-- CREACION DEL ESQUEMA

IF NOT EXISTS ( SELECT *
				FROM sys.schemas 
				WHERE name = N'VARIETE_GDD')  
EXEC ('CREATE SCHEMA [VARIETE_GDD] AUTHORIZATION [gd]');
GO

-- CREACION DE TABLAS

CREATE TABLE VARIETE_GDD.AFILIADO ( 
	AFI_NUMERO INTEGER IDENTITY(1,1) NOT NULL,
	AFI_TIPO_DOCUMENTO VARCHAR(3),
	AFI_DNI NUMERIC(8),
	AFI_NOMBRES VARCHAR(255),
	AFI_APELLIDO VARCHAR(255),
	AFI_DIRECCION VARCHAR(255),
	AFI_TELEFONO NUMERIC(18),
	AFI_MAIL VARCHAR(255),
	AFI_FECHA_NACIMIENTO DATETIME,
	AFI_SEXO CHAR(1), --'F' O 'M'
	AFI_ESTADO_CIVIL VARCHAR(11),
	AFI_CANTIDAD_FAMILIARES INTEGER,
	AFI_PLAN_MEDICO NUMERIC(18)	
)

CREATE TABLE VARIETE_GDD.PROFESIONAL ( 
	PRO_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	PRO_TIPO_DOCUMENTO VARCHAR(3),
	PRO_DNI NUMERIC(8),
	PRO_NOMBRES VARCHAR(255),
	PRO_APELLIDO VARCHAR(255),
	PRO_DIRECCION VARCHAR(255),
	PRO_TELEFONO NUMERIC(18),
	PRO_MAIL VARCHAR(255),
	PRO_FECHA_NACIMIENTO DATETIME,
	PRO_SEXO CHAR(1), --'F' O 'M'
	PRO_MATRICULA VARCHAR(50)
)

CREATE TABLE VARIETE_GDD.PROFESIONAL_ESPECIALIDADES (
	PROESP_PROFESIONAL INTEGER NOT NULL,
	PROESP_ESPECIALIDAD INTEGER NOT NULL
)

CREATE TABLE VARIETE_GDD.ESPECIALIDADES (
	ESP_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	ESP_DESCRIPCION VARCHAR (255),
	ESP_TIPO VARCHAR(80)
)

CREATE TABLE VARIETE_GDD.ADMINISTRADOR (
	ADM_CODIGO INTEGER IDENTITY(1,1) NOT NULL
)

CREATE TABLE VARIETE_GDD.USUARIO (
	USU_USERNAME VARCHAR(255) UNIQUE NOT NULL ,
	USU_CLAVE VARCHAR(255) NOT NULL,
	USU_CANTIDAD_INTENTOS INTEGER,
	USU_HABILITADO BIT
)

CREATE TABLE VARIETE_GDD.ROL_USUARIO (
	ROLUSU_USUARIO VARCHAR(255) NOT NULL,
	ROLUSU_ROL INTEGER NOT NULL
)


CREATE TABLE VARIETE_GDD.ROL (
	ROL_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	ROL_NOMBRE VARCHAR (255) NOT NULL,
	HABILITADO BIT NOT NULL
)

CREATE TABLE VARIETE_GDD.ROL_FUNCIONALIDADES (
	ROLFUN_ROL INTEGER NOT NULL,
	ROLFUN_FUNCIONALIDAD INTEGER NOT NULL
)	

CREATE TABLE VARIETE_GDD.FUNCIONALIDADES (
	FUN_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	FUN_DESCRIPCION VARCHAR(80) NOT NULL
)

CREATE TABLE VARIETE_GDD.TURNOS (
	TUR_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	TUR_PROFESIONAL INTEGER NOT NULL,
	TUR_AFILIADO INTEGER NOT NULL,
	TUR_FECHA DATETIME NOT NULL
)	

CREATE TABLE VARIETE_GDD.BONO_CONSULTA (
	BONCON_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	BONCON_AFILIADO INTEGER NOT NULL,
	BONCON_CONSULTA INTEGER NOT NULL,
	BONCON_FECHA DATETIME NOT NULL,
	BONCON_PLAN INTEGER NOT NULL,
	BONCON_COMPRA INTEGER NOT NULL
)

CREATE TABLE VARIETE_GDD.CONSULTA (
	CON_CONSULTA INTEGER IDENTITY(1,1) NOT NULL,
	CON_PROFESIONAL INTEGER NOT NULL, 
	CON_AFILIADO INTEGER NOT NULL,
	CON_TURNOS INTEGER NOT NULL,
	CON_FECHA_LLEGADA DATETIME,
	CON_SINTOMAS VARCHAR(255),
	CON_DIAGNOSTICO VARCHAR(1000),
	CON_BONO_CONSULTA INTEGER NOT NULL,
	CON_REALIZADA BIT
)

CREATE TABLE VARIETE_GDD.BONO_FARMACIA (
	BONFAR_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	BONFAR_AFILIADO INTEGER NOT NULL,
	BONFAR_FECHA DATETIME NOT NULL,
	BONFAR_RECETA INTEGER,
	--BONFAR_FECHA_VENCIMIENTO DATETIME?? ES CALCULABLE
	BONCON_PLAN INTEGER NOT NULL 
)

CREATE TABLE VARIETE_GDD.RECETA (
	REC_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	REC_CONSULTA INTEGER NOT NULL 
)

CREATE TABLE VARIETE_GDD.RECETA_MEDICAMENTOS (
	RECMED_RECETA INTEGER NOT NULL,
	RECMED_MEDICAMENTOS INTEGER NOT NULL,
	RECMED_CANTIDAD INTEGER
)

CREATE TABLE VARIETE_GDD.MEDICAMENTOS (
	MED_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	MED_NOMBRE VARCHAR(255)
)

CREATE TABLE VARIETE_GDD.PLANES (
	PLA_CODIGO NUMERIC(18) IDENTITY(1,1) NOT NULL,
	PLA_DESCRIPCION VARCHAR(255),
	PLA_PRECIO_BONO_FARMACIA NUMERIC(18),
	PLA_PRECIO_BONO_CONSULTA NUMERIC (18)	
)

CREATE TABLE VARIETE_GDD.COMPRA (
	COM_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	COM_FECHA DATETIME,
	COM_CANTIDAD_BONO_FARMACIA INTEGER, --RELACIONA CON BONO_FARMACIA (FK)
	COM_CANTIDAD_BONO_CONSULTA INTEGER, --RELACIONA CON BONO_FARMACIA (FK)
	COM_PRECIO FLOAT,
	COM_AFILIADO INTEGER	
)	


CREATE TABLE VARIETE_GDD.AGENDA(
	AGE_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
	AGE_PROFESIONAL INTEGER NOT NULL,
	AGE_FECHA_INICIO DATETIME,
	AGE_FECHA_FIN DATETIME
)

CREATE TABLE VARIETE_GDD.DIAS_ATENCION(
	DIAATE_CODIGO INTEGER IDENTITY(1,1) NOT NULL,
    DIAATE_DIA CHAR (1) NOT NULL,
    DIAATE_HORARIO_INICIO DATETIME,
    DIAATE_HORARIO_FIN DATETIME,
    DIAATE_FECHA DATETIME,
    DIAATE_AGENDA INTEGER NOT NULL
)
               
        
--NO ESTOY SEGURA SI ESTA BIEN LA PARTE DE LA AGENDA, ES NA RELACION MUCHOS MUCHO ENTRE LOS DIAS_ATENCION Y LA AGENDA?

--FALTA CREAR TABLA  FORMULARIO Y ELEMENTOS


--CONSTRAINTS (PK Y FK)

--//AFILIADO
ALTER TABLE VARIETE_GDD.AFILIADO ADD PRIMARY KEY (AFI_NUMERO);
ALTER TABLE VARIETE_GDD.AFILIADO ADD FOREIGN KEY (AFI_PLAN_MEDICO) REFERENCES PLANES(PLA_CODIGO);

--//PROFESIONAL	
ALTER TABLE VARIETE_GDD.PROFESIONAL ADD PRIMARY KEY (PRO_CODIGO);

--//PROFESIONAL_ESPECIALIDADES
ALTER TABLE VARIETE_GDD.PROFESIONAL_ESPECIALIDADES ADD PRIMARY KEY (PROESP_PROFESIONAL,PROESP_ESPECIALIDAD);
ALTER TABLE VARIETE_GDD.PROFESIONAL_ESPECIALIDADES ADD FOREIGN KEY (PROESP_PROFESIONAL) REFERENCES PROFESIONAL(PRO_CODIGO);
ALTER TABLE VARIETE_GDD.PROFESIONAL_ESPECIALIDADES ADD FOREIGN KEY (PROESP_ESPECIALIDAD) REFERENCES ESPECIALIDADES(ESP_CODIGO);

--//ESPECIALIDADES
ALTER TABLE VARIETE_GDD.ESPECIALIDADES ADD PRIMARY KEY (ESP_CODIGO);

--//ADMINISTRADOR
ALTER TABLE VARIETE_GDD.ADMINISTRADOR ADD PRIMARY KEY (ADM_CODIGO);

--//USUARIO
ALTER TABLE VARIETE_GDD.USUARIO ADD PRIMARY KEY (USU_USERNAME);

--//ROL_USUARIO
ALTER TABLE VARIETE_GDD.ROL_USUARIO ADD PRIMARY KEY (ROLUSU_USUARIO,ROLUSU_ROL);
ALTER TABLE VARIETE_GDD.ROL_USUARIO ADD FOREIGN KEY (ROLUSU_USUARIO) REFERENCES USUARIO(USU_USERNAME);
ALTER TABLE VARIETE_GDD.ROL_USUARIO ADD FOREIGN KEY (ROLUSU_ROL) REFERENCES ROL(ROL_CODIGO);


--//ROL
ALTER TABLE VARIETE_GDD.ROL ADD PRIMARY KEY (ROL_CODIGO);

--//ROL_FUNCIONALIDADES
ALTER TABLE VARIETE_GDD.ROL_FUNCIONALIDADES ADD PRIMARY KEY (ROLFUN_ROL,ROLFUN_FUNCIONALIDAD);
ALTER TABLE VARIETE_GDD.AFILIADO ADD FOREIGN KEY (ROLFUN_ROL) REFERENCES ROL(ROL_CODIGO);
ALTER TABLE VARIETE_GDD.AFILIADO ADD FOREIGN KEY (ROLFUN_FUNCIONALIDAD) REFERENCES FUNCIONALIDADES(FUN_CODIGO);

--//FUNCIONALIDADES
ALTER TABLE VARIETE_GDD.FUNCIONALIDADES ADD PRIMARY KEY (FUN_CODIGO);

--//TURNOS
ALTER TABLE VARIETE_GDD.TURNOS ADD PRIMARY KEY (TUR_CODIGO);
ALTER TABLE VARIETE_GDD.TURNOS ADD FOREIGN KEY (TUR_PROFESIONAL) REFERENCES PROFESIONAL(PRO_CODIGO);
ALTER TABLE VARIETE_GDD.TURNOS ADD FOREIGN KEY (TUR_AFILIADO) REFERENCES AFILIADO(AFI_NUMERO);


--//BONO_CONSULTA
ALTER TABLE VARIETE_GDD.BONO_CONSULTA ADD PRIMARY KEY (BONCON_CODIGO);
ALTER TABLE VARIETE_GDD.BONO_CONSULTA ADD FOREIGN KEY (BONCON_AFILIADO) REFERENCES AFILIADO(AFI_NUMERO);
ALTER TABLE VARIETE_GDD.BONO_CONSULTA ADD FOREIGN KEY (BONCON_CONSULTA) REFERENCES CONSULTA(CON_CONSULTA);
ALTER TABLE VARIETE_GDD.BONO_CONSULTA ADD FOREIGN KEY (BONCON_PLAN) REFERENCES PLANES(PLA_CODIGO);
ALTER TABLE VARIETE_GDD.BONO_CONSULTA ADD FOREIGN KEY (BONCON_COMPRA) REFERENCES COMPRA(COM_CODIGO);

	
--//CONSULTA
ALTER TABLE VARIETE_GDD.CONSULTA ADD PRIMARY KEY (CON_CONSULTA);
ALTER TABLE VARIETE_GDD.CONSULTA ADD FOREIGN KEY (CON_PROFESIONAL) REFERENCES PROFESIONAL(PRO_CODIGO);
ALTER TABLE VARIETE_GDD.CONSULTA ADD FOREIGN KEY (CON_AFILIADO) REFERENCES AFILIADO(AFI_NUMERO);
ALTER TABLE VARIETE_GDD.CONSULTA ADD FOREIGN KEY (CON_TURNOS) REFERENCES TURNOS(TUR_CODIGO);
ALTER TABLE VARIETE_GDD.CONSULTA ADD FOREIGN KEY (CON_BONO_CONSULTA) REFERENCES BONO_CONSULTA(BONCON_CODIGO);


--//BONO_FARMACIA
ALTER TABLE VARIETE_GDD.BONO_FARMACIA ADD PRIMARY KEY (BONFAR_CODIGO);
ALTER TABLE VARIETE_GDD.BONO_FARMACIA ADD FOREIGN KEY (BONFAR_AFILIADO) REFERENCES AFILIADO(AFI_NUMERO);
ALTER TABLE VARIETE_GDD.BONO_FARMACIA ADD FOREIGN KEY (BONFAR_RECETA) REFERENCES RECETA(REC_CODIGO);
ALTER TABLE VARIETE_GDD.BONO_FARMACIA ADD FOREIGN KEY (BONFAR_PLAN) REFERENCES PLANES(PLA_CODIGO);


--//RECETA
ALTER TABLE VARIETE_GDD.RECETA ADD PRIMARY KEY (REC_CODIGO);

--//RECETA_MEDICAMENTOS
ALTER TABLE VARIETE_GDD.RECETA_MEDICAMENTOS ADD PRIMARY KEY (RECMED_RECETA,RECMED_MEDICAMENTOS);

--//MEDICAMENTOS	
ALTER TABLE VARIETE_GDD.MEDICAMENTOS ADD PRIMARY KEY (MED_CODIGO);

--//PLANES
ALTER TABLE VARIETE_GDD.PLANES ADD PRIMARY KEY (PLA_CODIGO);

--//COMPRA
ALTER TABLE VARIETE_GDD.COMPRA ADD PRIMARY KEY (COM_CODIGO);

--//AGENDA
ALTER TABLE VARIETE_GDD.AGENDA ADD PRIMARY KEY (AGE_CODIGO);

--//DIAS_ATENCION
ALTER TABLE VARIETE_GDD.DIAS_ATENCION ADD PRIMARY KEY (DIAATE_CODIGO);



COMMIT;	